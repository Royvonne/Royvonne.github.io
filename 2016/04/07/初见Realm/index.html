<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>初见Realm | Roy Lee</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Roy Lee">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-new_bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
            
            <h1 class="blog-title">Roy Lee</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2016-04-07T08:28:44.000Z" itemprop="datePublished">
          2016-04-07
      </time>
    
    
    | 
    <a href='/tags/Realm/'>Realm</a>
    
    
</span>
    <h1 class="post-title">初见Realm</h1>
    <section class="post-content">
      <p>关于Realm，其实很早之前就有看到不少文章，当时公司没有持久化保存的需求，我也就没动力去研究。最近公司决定给客户端加上聊天功能，需要用到数据库了。我想终于可以用用这个慕名已久的数据库了。本篇文章是介绍Realm和简单的应用例子，方便自己查询，不用动不动看文档，一开始可能不会涉及到复杂的东西，如多线程，加密那些。循序渐进，因为我也是刚开始挖坑之旅。       </p>
<h3 id="u4E3A_u4EC0_u4E48_u9009_u62E9Realm"><a href="#u4E3A_u4EC0_u4E48_u9009_u62E9Realm" class="headerlink" title="为什么选择Realm"></a>为什么选择Realm</h3><p>原因就是：快、准，支持多平台，其次就是程序猿需要学点新东西。   </p>
<ul>
<li>快 - 因为Realm的实现有别于传统的数据库解决方法，减少了很多读写过程，所以速度快。    </li>
<li>准 - Realm是面向对象的，对象就是一切，所以它可以不用像传统数据库一样先遍历获取到一行数据再截取自己想要的，而是直接、准确的通过属性获得数据。   </li>
</ul>
<h3 id="u600E_u4E48_u7528"><a href="#u600E_u4E48_u7528" class="headerlink" title="怎么用"></a>怎么用</h3><p>安装步骤我就跳过了，大家可以参考一下<a href="https://realm.io/docs/swift/latest/" target="_blank" rel="external">官方文档</a>，足够详细的文档！<br>关于Realm还有一个插件可以安装，用于快速生成Realm model。 我们可以通过Alcatraz搜索<code>RealmPlugin</code>。安装成功后在新建文件(command + N)的时候，会出现多一个选项：<img src="http://7xsq0h.com2.z0.glb.clouddn.com/Realm%E6%8F%92%E4%BB%B6.png" alt="插件">   </p>
<h4 id="1-__u6570_u636E"><a href="#1-__u6570_u636E" class="headerlink" title="1. 数据"></a>1. 数据</h4><p>通过刚刚安装的插件，我们先创建两个新的model类，并且添加一些属性。 </p>
<h5 id="swift_3A"><a href="#swift_3A" class="headerlink" title="swift:"></a>swift:</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>: <span class="typename">Object &#123;</span></span></span><br><span class="line">    </span><br><span class="line">    dynamic <span class="variable"><span class="keyword">var</span> name</span> = <span class="string">""</span></span><br><span class="line">    dynamic <span class="variable"><span class="keyword">var</span> age</span> = <span class="number">0</span></span><br><span class="line">    dynamic <span class="variable"><span class="keyword">var</span> ownerName</span> = <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<p>class Owner: Object {</p>
<pre><code>dynamic var name = &quot;&quot;
let cats = List&lt;Cat&gt;()
</code></pre><p>}<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">##### OC:</span></span><br></pre></td></tr></table></figure></p>
<p>@interface Cat : RLMObject</p>
<p>@property NSString <em>ownerName;<br>@property NSString </em>name;<br>@property NSInteger age;</p>
<p>@end<br>RLM_ARRAY_TYPE(Cat)<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="variable">@interface</span> <span class="attribute">Owner </span>: RLMObject</span><br><span class="line"></span><br><span class="line"><span class="variable">@property</span> NSString *name;</span><br><span class="line"><span class="variable">@property</span> RLMArray&lt;Cat&gt; *cats;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br><span class="line"><span class="function">RLM_ARRAY_TYPE</span>(Owner)</span><br></pre></td></tr></table></figure></p>
<p>因为公司没打算用swift，但是自己一直有在学，所以两个版本的代码我都写出来了。我在这里创建了一个Cat和Owner的model，<code>Object</code>/<code>RLMObject</code>是Realm的类。   </p>
<p><strong>Tips:</strong>          </p>
<ol>
<li>在swfit中，Realm model的属性都应该用<code>dynamic</code>修饰以便访问数据库数据，但是有两个特例，上面看到的List是其中一个，可以理解为Array，还有一个是RealmOptional。   </li>
<li>在OC中，RLMArray有两种定义方法，<code>&lt;Object *&gt;</code>和<code>&lt;Object&gt;</code>，前者防止编译时使用错误的类型，后者让Realm在运行时确定数据model的架构。     </li>
<li>细心的朋友应该已经注意到OC版出现了一个这样的宏<code>RLM_ARRAY_TYPE()</code>，有了这个宏才能写上面<code>RLMArray&lt;Cat&gt;</code>这种格式的property。不纠结，跟着文档来就行。（用插件生成model的话，会自动帮你写上，不用担心忘掉。）       </li>
<li>应该还有一个注意到的就是和我们平常写的OC代码不一样，property后面没有weak、strong之类的修饰词，那是因为Realm内部就实现了完整的语义解析，还是那句，不纠结。      </li>
<li>OC的property默认可以为nil，假如需要限制不为空，要重写这个方法<code>+ requiredProperties</code>：   </li>
</ol>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="constant">NSArray</span> *)requiredProperties &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="annotation">@[@<span class="string">"name"</span>]</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-__u8BFB_u5199"><a href="#2-__u8BFB_u5199" class="headerlink" title="2. 读写"></a>2. 读写</h4><h5 id="u589E"><a href="#u589E" class="headerlink" title="增"></a>增</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cat = Cat()</span><br><span class="line">cat.name = @<span class="string">"旺财"</span>;</span><br><span class="line">cat.age = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! Realm()</span><br><span class="line"><span class="keyword">try</span>! realm.write &#123;</span><br><span class="line">    realm.add(cat)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`</span></span><br></pre></td></tr></table></figure>
<p>Cat <em>cat = [[Cat alloc] initWithValue:@{ @”name” : @”旺财”, @”age” : @1 }];<br>//Cat </em>cat = [[Cat alloc] initWithValue:@[ @”旺财”, @1 ]];</p>
<p>RLMRealm *realm = [RLMRealm defaultRealm];<br>[realm beginWriteTransaction];<br>[realm addObject:model];<br>[realm commitWriteTransaction];<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">从代码中，我们可以看到有三种方式可以用来创建对象。我就不一一说明了。在写入数据库的时候，需要开启一个事务。              </span><br><span class="line"></span><br><span class="line"><span class="preprocessor">##### 删</span></span><br></pre></td></tr></table></figure></p>
<p>try! realm.write {<br>    realm.delete(cat)         //删除一个<br>    //realm.deleteAll()          //删除全部<br>}</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[realm beginWriteTransaction];<br>[realm deleteObject:cat];     //删除一个<br>//[realm deleteAllObjects];   //删除全部<br>[realm commitWriteTransaction];<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">##### 改</span></span><br></pre></td></tr></table></figure></p>
<p>try! realm.write {<br>    cat.name = “奥利”<br>}<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>[realm beginWriteTransaction];<br>cat.name = @”奥利”;<br>[realm commitWriteTransaction];<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">*</span><span class="keyword">*</span>Tips:<span class="keyword">*</span><span class="keyword">*</span>             </span><br><span class="line">            </span><br><span class="line">1. Realm的model改支持设置主键，设置了主键就可以创建一个带主键的对象，然后存入数据库已达到更新的效果，假如对象不存在会自动添加。            </span><br><span class="line">2. 支持KVC</span><br><span class="line"></span><br><span class="line"><span class="comment">##### 查</span></span><br></pre></td></tr></table></figure></p>
<p>let cats = realm.objects(Cat)</p>
<p>// 链式<br>let cats = realm.objects(Cat).filter(“age == 1”)<br>let catWithName = cats.filter(“name CONTAINS ‘旺’”)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>RLMResults<cat *=""> *cats = [Cat allObjects]; </cat></p>
<p>// 链式<br>RLMResults <em>cats = [Cat objectsWhere:@”age == 1”];<br>RLMResults </em>catWithName = [cats objectsWhere:@”name CONTAINS ‘奥’”];</p>
<p>```<br><strong>Tips:</strong>        </p>
<ol>
<li>支持断言和NSPredicate，就是那些 ==、!=、CONTAINS等等。</li>
<li>支持链式查找。                </li>
</ol>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p>总体上来说Realm的使用十分简单，好像现在用到这个的公司还是挺多的，现在用起来就算有坑，应该也是前人走过的，个人觉得可以考虑在自己的项目中试试。</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Roy</h4>
    <p>iOS</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=iOS ?url=royvonne.com/2016/04/07/初见Realm/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=royvonne.com/2016/04/07/初见Realm/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=royvonne.com/2016/04/07/初见Realm/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=royvonne.com/2016/04/07/初见Realm/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/2016/04/06/hello-world/">
        Hello World123123 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Roy Lee</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>


<script type="text/javascript">
    var disqus_shortname = 'royvonnes2';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/archives"><span>Home</span></a>

          <a class="icon-apple"  href="/categories/iOS"><span>iOS</span></a>

          <a class="icon-book"  href="/categories/Other"><span>Other</span></a>

</nav>

</div>
</body>
</html>
